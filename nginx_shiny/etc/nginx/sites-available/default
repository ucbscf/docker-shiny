## For shiny
  map $http_upgrade $connection_upgrade {
      default upgrade;
      ''      close;
    }

server {
	listen 80 default_server;
	listen [::]:80 default_server;
	add_header Set-Cookie backend=shinynode01;

	root /var/www/html;

	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;

	server_name _;

	location / {
		# For Shiny
		proxy_pass http://.berkeley.edu:8838;
		proxy_redirect http://pooh.berkeley.edu:8838/ $scheme://$host:$server_port/;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection $connection_upgrade;
		proxy_read_timeout 20d;
	}

	location /nginx_status {
        stub_status on;

        access_log off;
        allow 128.32.135.0/24;
        deny all;
    }

}
